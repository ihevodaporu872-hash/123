# Исправленные баги и их решения

## 1. PDF Viewer — не открывался вообще

### Проблема
SimplePDF (`@simplepdf/react-embed-pdf`) зависит от внешнего сервиса `simplepdf.com` через iframe.
Кнопка Upload была навсегда disabled, показывался пустой iframe.

### Решение
Полная замена на `pdfjs-dist` (Mozilla PDF.js) — рендерит PDF локально без внешних зависимостей.

```typescript
import * as pdfjsLib from 'pdfjs-dist';
pdfjsLib.GlobalWorkerOptions.workerSrc = new URL(
  'pdfjs-dist/build/pdf.worker.min.mjs', import.meta.url
).toString();
```

### Файл: `src/components/PdfViewer/PdfViewer.tsx` — полная перезапись

---

## 2. Excel Viewer — загружался но ничего не показывал

### Проблема (3 уровня)

**Уровень 1**: Старый API Univer (`new Univer()` + `registerPlugin` + `createUnit`) — в v0.15.x рендерит UI-оболочку но НЕ рисует canvas-сетку таблицы.

**Уровень 2**: При переходе на `createUniver()` — передавал container как DOM-элемент вместо строкового ID.

**Уровень 3**: Не вызывал `univerAPI.createWorkbook(data)` отдельно после `createUniver()`.

### Решение
```typescript
import { createUniver, LocaleType, mergeLocales } from '@univerjs/presets';
import { UniverSheetsCorePreset } from '@univerjs/presets/preset-sheets-core';

// 1. Создаём div с уникальным ID
const containerId = `univer-container-${++containerIdCounter}`;
const univerDiv = document.createElement('div');
univerDiv.id = containerId;
wrapperRef.current.appendChild(univerDiv);

// 2. createUniver с container как STRING ID
const { univerAPI } = createUniver({
  locale: LocaleType.EN_US,
  locales: { [LocaleType.EN_US]: mergeLocales(sheetsEnUS) },
  presets: [UniverSheetsCorePreset({ container: containerId })],
});

// 3. createWorkbook ОТДЕЛЬНО
univerAPI.createWorkbook(workbookData);
```

### Дополнительный баг: DOM-конфликт React + Univer
При реинициализации Univer (загрузка нового файла) — ошибка `removeChild` потому что React и Univer оба управляли одним DOM-контейнером.

**Решение**: Wrapper div (React ref) + вручную создаваемый child div (Univer target). При реинициализации удаляем старый child, создаём новый.

### Файл: `src/components/ExcelViewer/ExcelViewer.tsx` — полная перезапись

---

## 3. CAD Viewer — ошибки при загрузке DWG

### Проблема
WASM файл `libredwg-web.wasm` не был доступен по HTTP.

### Решение
Скопирован `libredwg-web.wasm` из `node_modules/@mlightcad/libredwg-web/wasm/` в `public/wasm/`.

**Примечание**: DWG формат AC1032 (AutoCAD 2018) может не полностью поддерживаться libredwg-web.

### Файл: `public/wasm/libredwg-web.wasm` — скопирован

---

## 4. Навигация — TabNavigation не подключён

### Проблема
Компонент TabNavigation существовал, но не был импортирован в App.tsx.

### Решение
Добавлен импорт и рендеринг `<TabNavigation />` в App.tsx.

### Файл: `src/App.tsx` — модифицирован
